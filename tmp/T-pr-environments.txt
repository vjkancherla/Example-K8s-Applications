===========================================
TRUMID EPHEMERAL/PULL-REQUEST ENVIRONMENTS
===========================================

Create a Feature Branch and give it a name of the format: "deploy/<a-descriptive-comment>"
Eg: git checkout -b deploy/feature-xyz


Make the necessary changes, commit and push the feature branch to remote


Github will detect the new branch, matching regex - "name starts with deploy/", and will trigger a webhook to invoke a job Jenkins


The Pipeline/Job - unity-pr - is triggered in Jenkins

	- Git Branch Source Behaviour:
		- Discover Branches: All branches [Git-Plugin] 
		- Filter by name (with wildcards): Include=> deploy/* [SCM API Plugin]
		
	- Build Configuration
		- Mode: by JenkinsFile
		- Script Path: deploy/pipelines/jenkins/Jenkinsfile.ci
		

The Pipeline tasks:
- detects that this is a "unity-pr" job
- identifies that is invocation is by github
- identifies the author/owner of the git branch
- sends a slack message to author/owner with a link to the current invocation of the pipeline
- aborts the pipleline

The author/owner of the git branch then:
- clicks on the link in slack which opens the Jenkins console and take him to the invocation of the unity-pr pipeline
- the author click on "build with parameter", makes the necessary choices and clicks on build now.

The pipeline will:
- detects that this is a "unity-pr" job
- identifies that the author/owner has invoked the job
- 	- lint code
	- build code
	- build container image
	- scan container image
	- create/update helm chart
	- push container image to repo
	- push helm chart to repo
	- ensure test namespace is prepped
	- deploy the helm charts (built in CI) (application + monitoring + db_jobs (if_required)) to test namespace
	- send a slack message with the links to load-balancer/apps

The namespace will live for 3 hrs by default. There is an option to have a longer timeout period, whilst creating the Job.

A label is added to the name with the expiration time.

A separate job runs periodically, checks namespaces' "expiration" label and deletes namespaces that have expired.


-----

When the branch is deleted, the namespace is also cleaned up.		
	




