CONTINUOUS DELIVERY
-----------------------


CI/CD Server: Jenkins
	- running on K8s
	- runs Jenkins agents as pods, on K8s
	- the agent pods use different resources configurations based on the type of job
	- K8s cluster: arn:aws:eks:us-east-1:546849288051:cluster/ci-ats-v2 

CD - PRE-MERGE
--------
[1] When a PR is created, the following "pre-merge" CD job is triggered in Jenkins:

	- Pipeline:  unity-cd-pr

	- Git Branch Source Behaviour: 
		- Discover Branches: All branches [Git-Plugin] 
		- Discover Pull Requests from Origin: The current pull request revision [Git-Plugin] 
		- Filter by name (with wildcards): Include=> PR-* [SCM API Plugin]
		
	- Custom Github Notification Context [Github Custom Notification Context SCM Behaviour Plugin]
		- Label: continuous-integration/jenkins/unity-cd-pr
		
	- Specify ref specs: +refs/heads/*:refs/remotes/@{remote}/* [Git-Plugin] 
	
	- Build strategies [Basic Branch Build Strategies Plugin]:
		- Regular branches 
		- Change requests 
			- Ignore rebuilding merge branches when only the target branch changed
			- Ignore change requests flagged as originating from an untrusted source
			
	- Build Configuration
		- Mode: by JenkinsFile
		- Script Path: deploy/pipelines/jenkins/Jenkinsfile.cd
	
	- Pipeline Action Triggers
		- Include Filter: *

NOTE: In "Jenkinsfile.cd", there is logic TO ONLY RUN THE CD STEPS ON A PR IF AND ONLY IF A "*.SQL" FILE HAS CHANGED.
	- Only the checks are done, unity-cd-pr job is once again 



CD - POST-MERGE
-------
[1] When a PR is merged into either rc/*, master, prod/s116, prod/s117 branch, the following CD job is triggered in Jenkins:

	- Pipeline:  unity-cd-rc

	- Git Branch Source Behaviour: 
		- Discover Branches: All branches [Git-Plugin] 
		- Discover Pull Requests from Origin: The current pull request revision [Git-Plugin] 
		- Filter by name (with wildcards): Include=> rc/* master prod/s116 prod/s117 [SCM API Plugin]
										   Exclude=> rc/fwik/* rc/fix-rfq/* rc/sandbox-*
		
	- Custom Github Notification Context [Github Custom Notification Context SCM Behaviour Plugin]
		- Label: continuous-integration/unity-cd-rc
		
	- Specify ref specs: +refs/heads/*:refs/remotes/@{remote}/* [Git-Plugin] 
	
	- Build strategies [Basic Branch Build Strategies Plugin]:
		- Regular branches 
		- Change requests 
			- Ignore rebuilding merge branches when only the target branch changed
			- Ignore change requests flagged as originating from an untrusted source
			
	- Build Configuration
		- Mode: by JenkinsFile
		- Script Path: deploy/pipelines/jenkins/Jenkinsfile.cd
	
	- Pipeline Action Triggers
		- Include Filter: *
		
		

TASKS PERFORMED DURING CD
-------
All the tasks are performed through Bazel. Bazel is configured to utilize "buildbuddy" for build event viewing, result storing, remote caching, and remote build execution platform.
	- Build images and push to repo (Bazel)
	- Build Helm Charts and push to repo (Bazel)
	- Deploy charts to ci-ats-v2 cluster, under namespace rc-master (or rc-prod-s117, rc-prod-s117)
	- Run Test suite (e-2-e tests)
	- Uninstall charts
	- Uninstall charts